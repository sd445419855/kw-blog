<!DOCTYPE HTML><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>虚拟机_基础知识（idnex）</title>
    
<style id="wiz_custom_css">html, .wiz-editor-body {font-size: 12pt;}.wiz-editor-body {font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height: 1.7;margin: 0 auto;position:relative;padding: 20px 16px;}.wiz-editor-body h1,.wiz-editor-body h2,.wiz-editor-body h3,.wiz-editor-body h4,.wiz-editor-body h5,.wiz-editor-body h6 {margin:20px 0 10px;margin:1.25rem 0 0.625rem;padding: 0;font-weight: bold;}.wiz-editor-body h1 {font-size:20pt;font-size:1.67rem;}.wiz-editor-body h2 {font-size:18pt;font-size:1.5rem;}.wiz-editor-body h3 {font-size:15pt;font-size:1.25rem;}.wiz-editor-body h4 {font-size:14pt;font-size:1.17rem;}.wiz-editor-body h5 {font-size:12pt;font-size:1rem;}.wiz-editor-body h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1rem 0;}.wiz-editor-body div,.wiz-editor-body p,.wiz-editor-body ul,.wiz-editor-body ol,.wiz-editor-body dl,.wiz-editor-body li {margin:8px 0 0;}.wiz-editor-body blockquote,.wiz-editor-body table,.wiz-editor-body pre,.wiz-editor-body code {margin:8px 0;}.wiz-editor-body .CodeMirror pre {margin:0;}.wiz-editor-body a {word-wrap: break-word;text-decoration-skip-ink: none;}.wiz-editor-body ul,.wiz-editor-body ol {padding-left:32px;padding-left:2rem;}.wiz-editor-body ol.wiz-list-level1 > li {list-style-type:decimal;}.wiz-editor-body ol.wiz-list-level2 > li {list-style-type:lower-latin;}.wiz-editor-body ol.wiz-list-level3 > li {list-style-type:lower-roman;}.wiz-editor-body li.wiz-list-align-style {list-style-position: inside; margin-left: -1em;}.wiz-editor-body blockquote {padding: 0 12px;}.wiz-editor-body blockquote > :first-child {margin-top:0;}.wiz-editor-body blockquote > :last-child {margin-bottom:0;}.wiz-editor-body img {border:0;max-width:100%;height:auto !important;margin:2px 0;padding: 2px;vertical-align:bottom;}.wiz-editor-body table {border-collapse:collapse;border:1px solid #a7afbc;}.wiz-editor-body td,.wiz-editor-body th {padding:4px 8px;border-collapse:collapse;border:1px solid #a7afbc;min-height:28px;word-break:break-word;box-sizing: border-box;}.wiz-editor-body td > div:first-child {margin-top:0;}.wiz-editor-body td > div:last-child {margin-bottom:0;}.wiz-editor-body img.wiz-svg-image {box-shadow:1px 1px 4px #E8E8E8;}.wiz-editor-body .wiz-image-container {margin:0;max-width: 100%;display: inline-flex;flex-direction: column;}.wiz-editor-body .wiz-image-container .wiz-image-title {display:inline-block;text-align: center;color: #a7afbc;line-height: 18px;font-size: 12px;min-height: 18px;width: 100%;white-space: normal;}.wiz-hide {display:none !important;}.wiz-editor-body.wiz-editor-outline {padding-right:0; padding-left:0;}.wiz-editor-body.wiz-editor-outline .outline-container {margin:0; padding:0; line-height:1.5;}.wiz-editor-body.wiz-editor-outline .outline-container div {margin:0;}.wiz-editor-body.wiz-editor-outline .node {margin:0; padding: 0;}.wiz-editor-body.wiz-editor-outline .outline-container > .node {margin-right:24px; margin-left:30px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .children {display:none;}.wiz-editor-body.wiz-editor-outline .node .row {position:relative; padding-left:26px;}.wiz-editor-body.wiz-editor-outline .node .operator-container {width:36px;position:absolute; top:4px; left:-18px;}.wiz-editor-body.wiz-editor-outline .node .operator-bar {position:absolute; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center;}.wiz-editor-body.wiz-editor-outline .node .switch {width:18px; height:18px;display:flex;flex-direction: column;align-items: center;overflow: hidden;}.wiz-editor-body.wiz-editor-outline .node .switch i {font-size:20px;position:relative;left:-1px;top:-1px;}.wiz-editor-body.wiz-editor-outline .node .switch.active {cursor:pointer;color:transparent; transition:transform 200ms ease 0s;}.wiz-editor-body.wiz-editor-outline .node.collapsed .switch.active {transform:rotateZ(-90deg);}.wiz-editor-body.wiz-editor-outline .node .row:hover .switch.active {color:#505F79}.wiz-editor-body.wiz-editor-outline .node .dot {display:flex; align-items:center; justify-content:center; border-radius:100%; width:18px; height:18px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .dot {background-color:rgba(80, 95, 121, .15);}.wiz-editor-body.wiz-editor-outline .node .dot-icon {background-color:#505F79; border-radius:100%; width:6px; height:6px;}.wiz-editor-body.wiz-editor-outline .node .child {margin-left:8px; border-left:1px solid #E6E9ED; padding-left:17px;}.wiz-editor-body.wiz-editor-outline .node .content {flex:1;outline:none; padding:4px 0;}.wiz-editor-body.wiz-editor-outline .node div.content {font-size:1rem;}.wiz-editor-body.wiz-editor-outline .node.complete > .row .content {text-decoration:line-through;color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .notes {outline:none; font-size:.8rem; color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .image {outline:none; padding-top:4px; padding-bottom:4px;}.wiz-editor-body.wiz-editor-outline .outline-container h1,.wiz-editor-body.wiz-editor-outline .outline-container h2,.wiz-editor-body.wiz-editor-outline .outline-container h3,.wiz-editor-body.wiz-editor-outline .outline-container h4,.wiz-editor-body.wiz-editor-outline .outline-container h5,.wiz-editor-body.wiz-editor-outline .outline-container h6 {margin:0;}body, .wiz-editor-body {  padding-left: 48px;  padding-right: 48px;}</style></head>

<body onload="parent.window.document.all.dd.height=document.body.scrollHeight" class="wiz-editor-body " data-wiz-document-type="common" spellcheck="false" style="opacity: 1;" ><div style="text-align: center;"><br></div><div><span data-wiz-span="data-wiz-span"><br></span></div><h1><span data-wiz-span="data-wiz-span">网络</span></h1><hr><h1><a name="虚拟机在&nbsp;NAT&nbsp;网络模式下与宿主机之间的网络工作原理"><br></a></h1><h2><a name="虚拟机在&nbsp;NAT&nbsp;网络模式下与宿主机之间的网络工作原理">虚拟机在&nbsp;NAT&nbsp;网络模式下与宿主机之间的网络工作原理</a></h2><blockquote></blockquote><blockquote><div><span data-wiz-span="data-wiz-span">我们经常会用虚拟机来模拟 Server 或 Client，但是虚拟机在&nbsp;NAT 网络模式下，与宿主机之间的网络是怎么构成的？又是怎么通信的？为什么虚拟机 NAT 模式下 ping 不通 VMnet8 ？&nbsp;以&nbsp;VMware 为例，今天我们就来揭开虚拟机 NAT 网络模式的神秘面纱。</span></div></blockquote><blockquote><blockquote><div><div style="text-align: center;"><img src="虚拟机_基础知识（idnex）_files/4b644d94-f764-4bb7-8a88-6363574a6c5a.png"></div></div></blockquote></blockquote><blockquote><div><span data-wiz-span="data-wiz-span"><br></span></div></blockquote><blockquote><div><span data-wiz-span="data-wiz-span"><br></span></div></blockquote><h3 style=""><span data-wiz-span="data-wiz-span">NAT 概念：</span></h3><blockquote><div><span data-wiz-span="data-wiz-span">Network Address Translation，网络地址转换，即把一个网段的 IP 地址转成（映射）另一个网段的 IP 地址，基于这个功能，它可以把内网 IP 地址转为 外网 IP 地址，这样就可以让一个机构以一个公用IP（Internet Protocol）地址出现在Internet 上，这就在一定程度上有效地解决了公网 IP 地址紧缺的问题。</span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span">NAT 设备类似路由器，以前是单独一个 NAT 设备，现在路由器都会集成这个功能。NAT 其实就是个网络中介，他跟外网对接，外网只认他，你要上外网？只能找他。基于这个模式，你就只能由内向外访问，不能由外向内。因为由外向内访问时，目的主机的真实 IP 地址是无法作为目的 IP 地址使用的，该真实 IP 属于内网 IP，不会存在于外网路由器的路由表里。</span></div></blockquote><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span><b><span data-wiz-span="data-wiz-span">NAT 的类型：</span></b></span></div><div><ul><li><span data-wiz-span="data-wiz-span">静态 NAT (Static NAT)：手动一对一静态映射 IP 地址，即一个内网 IP 对应 一个外网 IP。</span></li><li><span data-wiz-span="data-wiz-span">动态 NAT (Pooled NAT)：在地址池中一对一动态映射&nbsp;IP 地址，即一个内网 IP 对应 一个外网 IP。</span></li><li><span data-wiz-span="data-wiz-span">端口 NAT（NAPT，Port-Level NAT)：借助端口号多对一动态映射 IP 地址，即多个内网 IP 对应 一个外网 IP&nbsp;的不同端口号。该类型最为常用。</span></li></ul></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span><b><span data-wiz-span="data-wiz-span">NAT 的优点（应用）：</span></b></span></div><div><ul><li><span data-wiz-span="data-wiz-span">IP 共享：节约公网 IP。</span></li><li><span data-wiz-span="data-wiz-span">IP&nbsp;隐藏：内网主机不可直接访问，实现对内网主机的保护。</span></li></ul></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span><b><span data-wiz-span="data-wiz-span">NAT 的缺点：</span></b></span></div><div><ul><li><span data-wiz-span="data-wiz-span">丧失端到端寻址能力，无法建立无中间商的真正的端对端（P2P）连接。</span></li><li><span data-wiz-span="data-wiz-span">某些应用不支持。</span></li><li><span data-wiz-span="data-wiz-span">使安全协议变的复杂。</span></li><li><span data-wiz-span="data-wiz-span">如果一个路由器出现故障，最初设计的TCP/IP协议过程将发生变化，Internet 可能变得非常脆弱。</span></li><li><span data-wiz-span="data-wiz-span">修改了 N+1 层报头内容，破坏了网络分层各层独立的原则。</span></li><li><span data-wiz-span="data-wiz-span">临时缓解 IP 地址短缺，推迟 IPv6 迁移，没有解决深层次问题。</span></li></ul></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span">&nbsp; &nbsp;&nbsp;</span><b><span data-wiz-span="data-wiz-span">Ref：</span></b></div><blockquote><blockquote><div><div><a href="https://blog.csdn.net/ljk0922/article/details/51564305"><span data-wiz-span="data-wiz-span" style="text-decoration-skip-ink:none">《csdn - NAT 简介》</span></a></div></div></blockquote><blockquote><div><div><a href="https://www.cnblogs.com/pacifist/p/11562268.html"><span data-wiz-span="data-wiz-span" style="text-decoration-skip-ink:none">《cnblogs -&nbsp;NAT的三种类型》</span></a></div></div></blockquote></blockquote><div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div></div><div><span data-wiz-span="data-wiz-span"><br></span></div><h3 style=""><span data-wiz-span="data-wiz-span">NAT 工作原理：</span></h3><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span">以最常用的 NAPT 为例，转换过程如下图所示。在转换过程中，关键的是那张转换关系映射表—— Track Table，这就像一个路由表。<br></span></div><div><span data-wiz-span="data-wiz-span">转换的本质是修改转发的数据包中的数据，即修改请求数据包中的源地址、源端口（如果端口被占用），以及响应数据包中的目的地址和目的端口（如果端口被占用）。<br></span></div><blockquote><blockquote><div style="text-align: center;"><span><img src="虚拟机_基础知识（idnex）_files/0.026079756372722307.png"></span></div></blockquote></blockquote><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span">看完上图，应该会有个疑问——NAT 网络的两端怎么通信的？</span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span">很简单，NAT 就相当于一个中介，所有无论请求数据包还是响应数据包都经他手，由它转发。比如说，公司内部某个人 Kai 要发个包裹出去给外部的某个人 Wan，包裹会先转交给公司的快递中介 NAT，中介改寄件人为公司名称 KaiSaJiTuan 后再交给快递公司顺丰寄出去，外部收件人 Wan 收到包裹后很高兴，准备回寄一个包裹，这个回寄包裹的收件人是公司 KaiSaJiTuan，中介收到&nbsp;KaiSaJiTuan 的包裹后，改收件人&nbsp;KaiSaJiTuan&nbsp;为 Kai 再找个跑腿的 Router 或 Switch 把包裹送到 Kai 手中。<br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span">&nbsp; &nbsp;&nbsp;</span><b><span data-wiz-span="data-wiz-span">Ref：</span></b></div><blockquote><blockquote><div><a href="https://blog.csdn.net/hzhsan/article/details/45038265"><span data-wiz-span="data-wiz-span" style="text-decoration-skip-ink:none">《csdn -&nbsp;网络地址转换NAT原理（易于理解）》</span></a></div></blockquote><blockquote><div><span><a href="https://zhuanlan.zhihu.com/p/375937088"><span data-wiz-span="data-wiz-span" style="text-decoration-skip-ink:none">《知乎 - NAT地址转换详解-附抓包（ICMP HTTP DNS）》</span></a></span></div></blockquote></blockquote><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><h3 style=""><span data-wiz-span="data-wiz-span">虚拟机 NAT&nbsp;工作原理：</span></h3><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span">虚拟机 NAT 模式下，虚拟机和宿主机之间通过一台&nbsp;VMnet8&nbsp;虚拟交换机、一个宿主机 VMnet8 虚拟网卡、一个虚拟 NAT 设备（网关）连接关系如下：<br></span></div><blockquote><blockquote style="text-align: center;"><img src="虚拟机_基础知识（idnex）_files/0.8906391143679302.png"></blockquote></blockquote><blockquote><blockquote></blockquote></blockquote><blockquote></blockquote><blockquote></blockquote><div><ul><li><span data-wiz-span="data-wiz-span">虚拟 NAT 设备（网关）可以看做是一个带 NAT 功能的三层路由器，这样更好理解。</span></li><li><span data-wiz-span="data-wiz-span">红色虚线圈中的整个单元才是完整的虚拟 NAT 设备（网关）。</span></li><li><span data-wiz-span="data-wiz-span">二层的&nbsp;VMnet8&nbsp;虚拟交换机的作用是连接宿主机和虚拟机“们”到同一局域网（同一网段）中来进行双向通信。</span></li><li><span data-wiz-span="data-wiz-span">虚拟机访问宿主机物理网卡时，由于物理网卡与虚拟机不属于同一局域网，因此要通过网关——虚拟 NAT 设备（网关）来访问。</span></li><li><span data-wiz-span="data-wiz-span">虚拟 NAT 设备（网关）的作用是让虚拟机直接借助宿主机真实网卡上外网，并不需要宿主机的&nbsp;VMnet8 虚拟网卡，也不需要真实网卡共享网络。</span></li><li><span data-wiz-span="data-wiz-span">虚拟 NAT 设备（网关）转换的内容是把虚拟机的 IP 地址转为宿主机真实网卡的 IP 地址，让虚拟机与宿主机共享一个 IP 地址。</span></li><li><span data-wiz-span="data-wiz-span">种种迹象表明，虚拟 NAT 设备（网关）与宿主机同时在使用宿主机的真实网卡，这表示该真实网卡也是虚拟 NAT 设备的网卡，这也是为什么把虚拟机 IP 转为宿主机真实网卡 IP 却不会冲突，以及会有那句“与虚拟机共享主机 IP” 的原因。也就是说，虚拟 NAT 设备（网关）有&nbsp;2 个网卡。</span></li><li><span data-wiz-span="data-wiz-span">宿主机的&nbsp;VMnet8 虚拟网卡的作用是与虚拟机通信，而不是让虚拟机上外网，禁用这个网卡虚拟机依旧可以上网。</span></li><li><span data-wiz-span="data-wiz-span">DHCP 服务器和&nbsp;NAT 服务器是分开的，各有一个网卡和 IP 地址，一般 NAT 服务器是&nbsp;.2，DHCP 服务器是&nbsp;.254。它们的服务也都在宿主机上。</span></li></ul></div><blockquote><blockquote><blockquote style="text-align: center;"><img src="虚拟机_基础知识（idnex）_files/374ec424-d7b4-471a-b4ba-34ced093f5f2.png"><span data-wiz-span="data-wiz-span"><br></span></blockquote><div><div><span data-wiz-span="data-wiz-span"><br></span></div></div></blockquote></blockquote><blockquote></blockquote><blockquote><div><b><span data-wiz-span="data-wiz-span">Ref：</span></b></div></blockquote><blockquote><blockquote><blockquote><div><div><div><a href="https://www.cnblogs.com/ghl1024/p/8507210.html"><span data-wiz-span="data-wiz-span" style="text-decoration-skip-ink:none">《cnblogs - vmware三种网络模式的工作原理及配置详解》</span></a></div></div></div></blockquote></blockquote><blockquote><blockquote><div><div><span data-wiz-span="data-wiz-span">&nbsp; &nbsp;&nbsp;原文：</span><a href="https://www.cnblogs.com/sddai/p/9280119.html"><span data-wiz-span="data-wiz-span" style="text-decoration-skip-ink:none">《cnblogs - 深入理解VMware虚拟机网络通信原理》</span></a></div></div></blockquote></blockquote><blockquote><blockquote><div><div><div><a href="https://www.shuzhiduo.com/A/QW5Yon9qzm/"><span data-wiz-span="data-wiz-span" style="text-decoration-skip-ink:none">《shuzhiduo - 深入理解VMware虚拟机网络通信原理》</span></a></div></div></div></blockquote></blockquote></blockquote><div><span data-wiz-span="data-wiz-span">&nbsp; &nbsp;&nbsp;<br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><h3 style=""><span data-wiz-span="data-wiz-span">虚拟机 NAT&nbsp;配置：</span></h3><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span">关于虚拟机 NAT 网络的配置不是重点，详见：</span></div><blockquote><div><div><a href="https://blog.csdn.net/chuanxincui/article/details/80931197"><span data-wiz-span="data-wiz-span" style="text-decoration-skip-ink:none">《csdn - 虚拟机配置NAT网络》</span></a></div></div><div><div><a href="https://blog.csdn.net/dingguanyi/article/details/77829085"><span data-wiz-span="data-wiz-span" style="text-decoration-skip-ink:none">《csdn - VMware虚拟机NAT模式网络配置图文教程》</span></a></div></div></blockquote><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><h3 style=""><span data-wiz-span="data-wiz-span">疑问：</span></h3><div><div><b><span data-wiz-span="data-wiz-span"><br></span></b><b></b><b><span data-wiz-span="data-wiz-span">Q：</span></b><b><span data-wiz-span="data-wiz-span">在网络的&nbsp;OSI&nbsp;七层模型中，关于端口的疑问？</span></b></div><blockquote><div><span data-wiz-span="data-wiz-span">详情：哪一层开始出现的端口号的概念？哪一层需要用端口号寻找目标？路由器的转发属于三层转发，那需要用到端口号吗？数据怎么从一个端口到达另一个端口？如果端口没有被监听, 能抓包吗？如果端口没有被监听，数据包还会发过来吗？交换机转发数据包会看应用的端口吗？</span></div></blockquote><div><b><span data-wiz-span="data-wiz-span">A：</span></b><span data-wiz-span="data-wiz-span">要想知道端口是那一层的概念，是哪一层需要用端口号寻找目标，我们首先需要先从个人笔记</span><a href="/views/技术总结/前端技术/为知笔记/网络技术_基础知识（index）.html"><span data-wiz-span="data-wiz-span" style="text-decoration-skip-ink:none">《网络基础——一个数据</span></a><span><a href="/views/技术总结/前端技术/为知笔记/网络技术_基础知识（index）.html"><span data-wiz-span="data-wiz-span" style="text-decoration-skip-ink:none">包的整个传输过程》</span></a></span><span data-wiz-span="data-wiz-span">了解数据</span></div></div><blockquote><div><div><span data-wiz-span="data-wiz-span">包的传输过程。</span></div></div></blockquote><div><blockquote><div><span data-wiz-span="data-wiz-span">当我们了解之后就会明白，端口 (port) 是伴随着传输层诞生的概念，只有传输层才需要用端口号寻找目标。也就是说，数据只有在到达主机后才会寻找端口。那么路由器的三层转发还需要用到端口号吗？显然用不到了。</span></div><div><span><div><span data-wiz-span="data-wiz-span">那如果端口没有被监听, 能抓包吗？</span></div><div><span data-wiz-span="data-wiz-span">不监听端口你抓哪里的包呢？难道你从网线电信号里抓包吗？只有无线你才可以脱离目标主机抓包。</span></div><div><span data-wiz-span="data-wiz-span">那如果端口没有被监听，数据包还会发过来吗？</span></div><div><span data-wiz-span="data-wiz-span">会，发不发是路由器、交换机的事，收不收是主机的事。</span></div><div><span data-wiz-span="data-wiz-span">交换机转发数据包会看应用的端口吗？</span></div><div><span data-wiz-span="data-wiz-span">交换机是二层的，应用是七层的，你让它怎么看？就算是传输层的端口，也不会看，交换机只看 MAC 地址。<br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div></span></div></blockquote><blockquote><div><span><b><span data-wiz-span="data-wiz-span">Ref：</span></b></span></div><div><span data-wiz-span="data-wiz-span">&nbsp; &nbsp;&nbsp;</span><a href="https://blog.csdn.net/weixin_30376453/article/details/99949024"><span data-wiz-span="data-wiz-span" style="text-decoration-skip-ink:none">《csdn -&nbsp;TCP/IP详解学习笔记(6)-UDP协议》</span></a></div><div><span data-wiz-span="data-wiz-span">&nbsp; &nbsp;&nbsp;</span><a href="https://vd3.bdstatic.com/mda-khjpntdrdirssika/hd/mda-khjpntdrdirssika.mp4"><span data-wiz-span="data-wiz-span" style="text-decoration-skip-ink:none">《cisco - OSI 七层网络模型》</span></a><span data-wiz-span="data-wiz-span">&nbsp; &nbsp;&nbsp;</span></div><div><span data-wiz-span="data-wiz-span">&nbsp; &nbsp;&nbsp;</span><a href="https://zhidao.baidu.com/question/1509859863199917820.html"><span data-wiz-span="data-wiz-span" style="text-decoration-skip-ink:none">《百度 - 试说明路由器如何知道将数据包发送到哪个对应的端口》</span></a></div></blockquote><blockquote><div><span data-wiz-span="data-wiz-span">&nbsp; &nbsp;&nbsp;</span></div></blockquote><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><b><span data-wiz-span="data-wiz-span">Q：</span></b><b></b><b><span data-wiz-span="data-wiz-span">端口 NAT（</span></b><b></b><b><span data-wiz-span="data-wiz-span">NAPT）会为转发的数据包单独起一个端口来收发数据吗？</span></b></div><blockquote><div><span data-wiz-span="data-wiz-span">详情：NAT 设备在改变数据包 ip 后，会专门给该数据包起端口收发数据吗？数据包源端口号修改后，会起个同号的端口来收发数据吗？（由 NAT 引发疑问）</span></div></blockquote><div><b><span data-wiz-span="data-wiz-span">A：</span></b><span data-wiz-span="data-wiz-span">NAT 是三层设备，没有端口概念，自然也不存在启动端口，它改端口号只是为了避免内网 IP 的端口重复影响建立一对一的内外网 IP 映射关系。</span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><div><b><span data-wiz-span="data-wiz-span">Q：</span></b><span data-wiz-span="data-wiz-span"><b>虚拟机&nbsp;NAT 网络模式是否适合模拟集群、 Server-Client 通信这样的场景？是否适合做测试？</b></span></div></div><div><span data-wiz-span="data-wiz-span"><b><span data-wiz-span="data-wiz-span">A：</span></b>既然多个虚拟机和真机可以局域网互联，那么自然是适合的。<br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><b><span data-wiz-span="data-wiz-span">Q：</span></b><b>既然有 VMnet8 这个虚拟交换机存在，为什么不能直接用它连真机（宿主机）？</b></span></div><div><b><span data-wiz-span="data-wiz-span">A：</span></b>为什么不能？仅仅因为 ping 不通宿主机的 VMnet8 虚拟网卡就表示不能了？这太武断了。</div><blockquote><div>其实虚拟机和宿主机已经通过这个 VMnet8 交换机直连了，ping 不同是因为宿主机防火墙拦截了 VMnet8 的流量。详情见当前笔记<u>《遇到问题：虚拟机 NAT 模式下 ping 不通宿主机 VMnet8 虚拟网卡》</u></div></blockquote><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><h3 style=""><span data-wiz-span="data-wiz-span">开发问题：</span></h3><div><span><h3 style="font-size:1.25rem;"><br></h3></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><h3><span data-wiz-span="data-wiz-span">其他信息：</span></h3><div><span data-wiz-span="data-wiz-span">通过连接宿主机正在被监听的端口，可以证实，虚拟机网关和宿主机虚拟网卡是 2 回事。</span></div></div><div><br></div><div><div><br></div></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><span data-wiz-span="data-wiz-span"><br></span></div><div><blockquote><span data-wiz-span="data-wiz-span"><br></span></blockquote></div>

  <script type="text/javascript">
    /**
    * 让 iframe 中的 <a> 打开新页面
    */
    let aDoms = document.getElementsByTagName("a")
    for ( let aDom of aDoms ) {
      let oldHref = aDom.href;
      let newHref = "javascript:window.open('" + oldHref + "')";
      // console.info("aDom", aDom);
      aDom.href = newHref;
    }
  </script>

</body></html>